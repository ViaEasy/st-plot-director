<div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
        <strong>
            <i class="fa-solid fa-clapperboard"></i>
            <span data-i18n="Plot Director">Plot Director</span>
        </strong>
        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content">
        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="st-pd-tabs">
            <div class="st-pd-tab active" data-tab="basic">
                <i class="fa-solid fa-sliders"></i> åŸºç¡€é…ç½®
            </div>
            <div class="st-pd-tab" data-tab="advanced">
                <i class="fa-solid fa-gears"></i> é«˜çº§é…ç½®
            </div>
            <div class="st-pd-tab" data-tab="logs">
                <i class="fa-solid fa-chart-line"></i> æ—¥å¿—è¾“å‡º
            </div>
            <div class="st-pd-tab" data-tab="help">
                <i class="fa-solid fa-circle-question"></i> å¸®åŠ©
            </div>
        </div>

        <!-- æ ‡ç­¾é¡µå†…å®¹ï¼šåŸºç¡€é…ç½® -->
        <div class="st-pd-tab-content active" data-tab-content="basic">
<div class="st-pd-settings">
    <!-- Basic Settings -->
    <div class="st-pd-section">

        <div class="st-pd-row">
            <label data-i18n="Enable">Enable</label>
            <input type="checkbox" id="st_pd_enabled" />
            <span class="st-pd-status stopped" id="st_pd_status" data-i18n="Stopped">Stopped</span>
        </div>

        <div class="st-pd-row">
            <label data-i18n="Mode">Mode</label>
            <select id="st_pd_mode">
                <option value="auto" data-i18n="Full Auto">Full Auto</option>
                <option value="preview" data-i18n="Preview & Confirm">Preview & Confirm</option>
            </select>
        </div>

        <div class="st-pd-row">
            <label data-i18n="Rounds">Rounds</label>
            <input type="number" id="st_pd_rounds" min="1" max="100" value="5" />
            <span class="st-pd-progress" id="st_pd_progress"></span>
        </div>

        <div class="st-pd-btn-row">
            <div class="menu_button" id="st_pd_start" data-i18n="Start">Start</div>
            <div class="menu_button" id="st_pd_stop" data-i18n="Stop">Stop</div>
        </div>

        <div class="st-pd-row">
            <label data-i18n="Wait for chatu8">Wait for chatu8</label>
            <input type="checkbox" id="st_pd_wait_chatu8" />
        </div>

        <div class="st-pd-row">
            <label data-i18n="chatu8 Start Wait (s)">chatu8 Start Wait (s)</label>
            <input type="number" id="st_pd_chatu8_start_timeout" min="1" max="120" value="15" title="Max seconds to wait for chatu8 to start loading" />
        </div>

        <div class="st-pd-row">
            <label data-i18n="chatu8 Timeout (s)">chatu8 Timeout (s)</label>
            <input type="number" id="st_pd_chatu8_timeout" min="10" max="600" value="300" />
        </div>
    </div>

    <!-- API Configuration -->
    <div class="st-pd-section">
        <div class="st-pd-section-title">
            <i class="fa-solid fa-plug"></i>
            <span data-i18n="API Configuration">API Configuration</span>
        </div>

        <div class="st-pd-row">
            <label>å¿«é€Ÿæ¨¡æ¿</label>
            <select id="st_pd_api_template">
                <option value="">é€‰æ‹©æ¨¡æ¿...</option>
                <option value="openai">OpenAI</option>
                <option value="claude">Claude (Direct)</option>
                <option value="ollama">Ollama (Local)</option>
                <option value="proxy">SillyTavern Proxy</option>
            </select>
        </div>

        <div class="st-pd-preset-row" style="margin-bottom: 6px;">
            <select id="st_pd_api_config_select"></select>
            <div class="menu_button" id="st_pd_api_config_save" title="Save"><i class="fa-solid fa-floppy-disk"></i></div>
            <div class="menu_button" id="st_pd_api_config_delete" title="Delete"><i class="fa-solid fa-trash"></i></div>
        </div>

        <div class="st-pd-row">
            <label data-i18n="Connection">Connection</label>
            <select id="st_pd_connection_mode">
                <option value="proxy" data-i18n="Via SillyTavern Proxy">Via SillyTavern Proxy</option>
                <option value="direct" data-i18n="Direct Request">Direct Request</option>
            </select>
        </div>

        <div class="st-pd-row">
            <label data-i18n="API Type">API Type</label>
            <select id="st_pd_api_type">
                <option value="openai">OpenAI Compatible</option>
                <option value="claude">Claude</option>
            </select>
        </div>

        <div class="st-pd-row">
            <label data-i18n="API URL">API URL</label>
            <input type="text" id="st_pd_api_url" placeholder="https://api.openai.com/v1" />
        </div>

        <div class="st-pd-row">
            <label data-i18n="API Key">API Key</label>
            <div class="st-pd-api-key-wrapper">
                <input type="password" id="st_pd_api_key" placeholder="sk-..." />
                <i class="fa-solid fa-eye st-pd-toggle-key" id="st_pd_toggle_key"></i>
            </div>
        </div>

        <div class="st-pd-row">
            <label data-i18n="Model">Model</label>
            <input type="text" id="st_pd_model" placeholder="gpt-4o-mini" />
        </div>

        <div class="st-pd-row">
            <label data-i18n="Temperature">Temperature</label>
            <input type="number" id="st_pd_temperature" min="0" max="2" step="0.1" value="0.8" />
        </div>

        <div class="st-pd-row">
            <label data-i18n="Max Tokens">Max Tokens</label>
            <input type="number" id="st_pd_max_tokens" min="50" max="4096" step="50" value="300" />
        </div>

        <div class="st-pd-row">
            <label data-i18n="Context Messages">Context Messages</label>
            <input type="number" id="st_pd_context_length" min="1" max="100" value="20" title="Number of recent messages to include" />
        </div>

        <div class="st-pd-btn-row">
            <div class="menu_button" id="st_pd_test_connection" data-i18n="Test Connection">Test Connection</div>
        </div>
    </div>

    <!-- Preset Management -->
    <div class="st-pd-section">
        <div class="st-pd-section-title">
            <i class="fa-solid fa-sliders"></i>
            <span data-i18n="System Prompt Preset">System Prompt Preset</span>
            <span id="st_pd_unsaved_indicator" style="display:none; color: orange; margin-left: 5px;" title="æœ‰æœªä¿å­˜çš„æ›´æ”¹">*</span>
        </div>

        <div class="st-pd-preset-row">
            <select id="st_pd_preset_select"></select>
            <div class="menu_button" id="st_pd_preset_new" title="New"><i class="fa-solid fa-plus"></i></div>
            <div class="menu_button" id="st_pd_preset_delete" title="Delete"><i class="fa-solid fa-trash"></i></div>
            <div class="menu_button" id="st_pd_preset_import" title="Import"><i class="fa-solid fa-file-import"></i></div>
            <div class="menu_button" id="st_pd_preset_export" title="Export"><i class="fa-solid fa-file-export"></i></div>
        </div>

        <textarea class="st-pd-textarea text_pole" id="st_pd_system_prompt" placeholder="Enter system prompt for the plot director LLM..."></textarea>

        <div class="st-pd-btn-row">
            <div class="menu_button" id="st_pd_preset_save"><i class="fa-solid fa-floppy-disk"></i> Save Preset</div>
        </div>
    </div>
</div>
        </div>

        <!-- æ ‡ç­¾é¡µå†…å®¹ï¼šé«˜çº§é…ç½® -->
        <div class="st-pd-tab-content" data-tab-content="advanced">
<div class="st-pd-settings">
    <div class="st-pd-section">
        <div class="st-pd-section-title">
            <i class="fa-solid fa-bars-staggered"></i>
            <span data-i18n="Prompt Manager">Prompt Manager</span>
        </div>

        <div class="st-pd-pm-toolbar">
            <div class="st-pd-row">
                <label data-i18n="Chat History Format">Chat History Format</label>
                <select id="st_pd_chat_history_mode">
                    <option value="role" data-i18n="Role Mode (preserve roles)">Role Mode (preserve roles)</option>
                    <option value="text" data-i18n="Text Mode (single message)">Text Mode (single message)</option>
                </select>
            </div>
            <div class="st-pd-btn-row">
                <div class="menu_button" id="st_pd_pm_add_block">
                    <i class="fa-solid fa-plus"></i> <span data-i18n="Add Block">Add Block</span>
                </div>
                <div class="menu_button" id="st_pd_pm_add_template">
                    <i class="fa-solid fa-lightbulb"></i> åº”ç”¨åŸºç¡€æ¨¡æ¿
                </div>
            </div>
        </div>

        <div class="st-pd-pm-block-list" id="st_pd_pm_block_list">
            <!-- Blocks rendered dynamically by JS -->
        </div>
    </div>

    <!-- Regex Filters -->
    <div class="st-pd-section">
        <div class="st-pd-section-title">
            <i class="fa-solid fa-filter"></i>
            <span data-i18n="Regex Filters">Regex Filters</span>
        </div>

        <div class="st-pd-btn-row" style="margin-bottom: 6px;">
            <div class="menu_button" id="st_pd_regex_add_rule">
                <i class="fa-solid fa-plus"></i> <span data-i18n="Add Rule">Add Rule</span>
            </div>
            <div class="menu_button" id="st_pd_regex_add_examples">
                <i class="fa-solid fa-lightbulb"></i> æ·»åŠ å¸¸ç”¨ç¤ºä¾‹
            </div>
        </div>

        <div class="st-pd-regex-rule-list" id="st_pd_regex_rule_list">
            <!-- Rules rendered dynamically by JS -->
        </div>
    </div>

    <!-- Plot Outline -->
    <div class="st-pd-section">
        <div class="st-pd-section-title">
            <i class="fa-solid fa-scroll"></i>
            <span data-i18n="Plot Outline">Plot Outline (Optional)</span>
        </div>

        <div class="st-pd-row">
            <label data-i18n="Enable Outline">Enable Outline</label>
            <input type="checkbox" id="st_pd_outline_enabled" />
        </div>

        <div class="st-pd-row">
            <label title="æ§åˆ¶ outline æ³¨å…¥åˆ°å¯¼æ¼” LLM prompt çš„è½®æ•°">æ³¨å…¥åˆ°å¯¼æ¼” LLM çš„è½®æ•°</label>
            <input type="number" id="st_pd_outline_prompt_rounds" min="0" max="999" value="999"
                   title="999 = å§‹ç»ˆæ³¨å…¥, 1-998 = ä»…åœ¨å‰ N è½®æ³¨å…¥, 0 = æ°¸ä¸æ³¨å…¥" />
        </div>

        <div class="st-pd-row">
            <label title="æ§åˆ¶ outline æ³¨å…¥åˆ°ç”¨æˆ·æ¶ˆæ¯çš„è½®æ•°">æ³¨å…¥åˆ°ç”¨æˆ·æ¶ˆæ¯çš„è½®æ•°</label>
            <input type="number" id="st_pd_outline_inject_rounds" min="0" max="100" value="1"
                   title="0 = ä¸æ³¨å…¥, 1 = ä»…ç¬¬ 1 è½®, N = å‰ N è½®" />
        </div>

        <textarea class="st-pd-outline-textarea text_pole" id="st_pd_outline" placeholder="Enter your plot outline here..."></textarea>
    </div>
</div>
        </div>

        <!-- æ ‡ç­¾é¡µå†…å®¹ï¼šæ—¥å¿—è¾“å‡º -->
        <div class="st-pd-tab-content" data-tab-content="logs">
<div class="st-pd-settings">
    <!-- Input Log -->
    <div class="st-pd-section" data-section-id="input-log">
        <div class="st-pd-section-header" data-collapsible="true">
            <i class="fa-solid fa-chevron-down st-pd-collapse-icon"></i>
            <div class="st-pd-section-title">
                <i class="fa-solid fa-paper-plane"></i>
                <span data-i18n="Input Log">Input Log</span>
            </div>
        </div>
        <div class="st-pd-section-body">
            <textarea class="st-pd-llm-output text_pole" id="st_pd_input_log" rows="10" readonly placeholder="The messages sent to the director LLM will appear here..."></textarea>
        </div>
    </div>

    <!-- LLM Output -->
    <div class="st-pd-section" data-section-id="llm-output">
        <div class="st-pd-section-header" data-collapsible="true">
            <i class="fa-solid fa-chevron-down st-pd-collapse-icon"></i>
            <div class="st-pd-section-title">
                <i class="fa-solid fa-robot"></i>
                <span data-i18n="Director LLM Output">Director LLM Output</span>
            </div>
        </div>
        <div class="st-pd-section-body">
            <textarea class="st-pd-llm-output text_pole" id="st_pd_llm_output" rows="6" readonly placeholder="The latest director LLM response will appear here..."></textarea>
        </div>
    </div>

    <!-- Log -->
    <div class="st-pd-section" data-section-id="log">
        <div class="st-pd-section-header" data-collapsible="true">
            <i class="fa-solid fa-chevron-down st-pd-collapse-icon"></i>
            <div class="st-pd-section-title">
                <i class="fa-solid fa-terminal"></i>
                <span data-i18n="Log">Log</span>
            </div>
        </div>
        <div class="st-pd-section-body">
            <div class="st-pd-btn-row" style="margin-bottom: 6px;">
                <div class="menu_button" id="st_pd_log_filter_all">å…¨éƒ¨</div>
                <div class="menu_button" id="st_pd_log_filter_warn">ä»…è­¦å‘Š</div>
                <div class="menu_button" id="st_pd_log_filter_error">ä»…é”™è¯¯</div>
                <div class="menu_button" id="st_pd_log_export" data-i18n="Export Log">Export Log</div>
                <div class="menu_button" id="st_pd_log_clear" data-i18n="Clear Log">Clear Log</div>
            </div>
            <textarea class="st-pd-log-textarea text_pole" id="st_pd_log" rows="12" readonly placeholder="Log output..."></textarea>
        </div>
    </div>
</div>
        </div>

        <!-- æ ‡ç­¾é¡µå†…å®¹ï¼šå¸®åŠ© -->
        <div class="st-pd-tab-content" data-tab-content="help">
<div class="st-pd-settings">
    <div class="st-pd-help-section">
        <h3>ğŸš€ å¿«é€Ÿå…¥é—¨</h3>
        <ol>
            <li>åœ¨ã€ŒåŸºç¡€é…ç½®ã€ä¸­å¯ç”¨æ’ä»¶</li>
            <li>åœ¨ã€ŒAPI é…ç½®ã€ä¸­é€‰æ‹©å¿«é€Ÿæ¨¡æ¿æˆ–æ‰‹åŠ¨é…ç½®</li>
            <li>åœ¨ã€Œç³»ç»Ÿæç¤ºè¯é¢„è®¾ã€ä¸­ç¼–å†™å¯¼æ¼” LLM çš„æŒ‡ä»¤</li>
            <li>ç‚¹å‡»ã€Œå¼€å§‹ã€æŒ‰é’®å¯åŠ¨è‡ªåŠ¨å‰§æƒ…ç”Ÿæˆ</li>
        </ol>
    </div>

    <div class="st-pd-help-section">
        <h3>ğŸ’¡ åŠŸèƒ½è¯´æ˜</h3>
        <ul>
            <li><strong>Prompt Manager</strong>ï¼šè‡ªå®šä¹‰å‘é€ç»™å¯¼æ¼” LLM çš„æ¶ˆæ¯ç»“æ„</li>
            <li><strong>Regex Filters</strong>ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ LLM è¾“å‡º</li>
            <li><strong>Plot Outline</strong>ï¼šæä¾›å‰§æƒ…å¤§çº²å¼•å¯¼ç”Ÿæˆæ–¹å‘</li>
        </ul>
    </div>

    <div class="st-pd-help-section">
        <h3>â“ å¸¸è§é—®é¢˜</h3>
        <details>
            <summary>ä¸ºä»€ä¹ˆå¯¼æ¼” LLM æ²¡æœ‰å“åº”ï¼Ÿ</summary>
            <p>è¯·æ£€æŸ¥ï¼š1) API é…ç½®æ˜¯å¦æ­£ç¡® 2) API Key æ˜¯å¦æœ‰æ•ˆ 3) æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®</p>
        </details>
        <details>
            <summary>å¦‚ä½•ä½¿ç”¨ Proxy æ¨¡å¼ï¼Ÿ</summary>
            <p>é€‰æ‹©ã€ŒVia SillyTavern Proxyã€è¿æ¥æ¨¡å¼ï¼Œæ’ä»¶å°†ä½¿ç”¨ SillyTavern çš„ä»£ç†è®¾ç½®ã€‚</p>
        </details>
        <details>
            <summary>ä»€ä¹ˆæ˜¯ Prompt Managerï¼Ÿ</summary>
            <p>Prompt Manager å…è®¸ä½ è‡ªå®šä¹‰å‘é€ç»™å¯¼æ¼” LLM çš„æ¶ˆæ¯ç»“æ„ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæç¤ºè¯ã€èŠå¤©å†å²ã€å‰§æƒ…å¤§çº²ç­‰ã€‚ä½ å¯ä»¥è°ƒæ•´é¡ºåºã€å¯ç”¨/ç¦ç”¨ç‰¹å®šå—ã€‚</p>
        </details>
        <details>
            <summary>Regex Filters å¦‚ä½•ä½¿ç”¨ï¼Ÿ</summary>
            <p>Regex Filters å¯ä»¥å¯¹å¯¼æ¼” LLM çš„è¾“å‡ºè¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢ï¼Œä¾‹å¦‚å»é™¤æ—ç™½ã€ç»Ÿä¸€æ ‡ç‚¹ç¬¦å·ç­‰ã€‚æ”¯æŒæ‹–æ‹½æ’åºå’Œå¯ç”¨/ç¦ç”¨ã€‚</p>
        </details>
    </div>
</div>
        </div>
</div>
    </div>
</div>
